import{d as W,O as X,r as c,y as N,i as Y,p as V,w as o,e as a,c as i,u as s,a as u,F as v,n as _,g as n,j as g,t as d,o as r,q as ee,k as te,Q as se}from"./index-DG8erdFC.js";import{_ as le}from"./PageContainer.vue_vue_type_script_setup_true_lang-BIH9eeFm.js";import{_ as ae}from"./AreaCard.vue_vue_type_script_setup_true_lang-BUJNG2ka.js";import{_ as O}from"./index-CKTY9j9I.js";import{_ as q}from"./index-Cu9IoA6Q.js";import{_ as oe,a as ne,b as A,c as x,d as re,e as y}from"./TableHeader.vue_vue_type_script_setup_true_lang-DvNerfSY.js";import{a as ue,b as ie,c as de,d as fe,_ as me}from"./DialogTitle.vue_vue_type_script_setup_true_lang-rgETGbgT.js";import{_ as D}from"./Checkbox.vue_vue_type_script_setup_true_lang-BlmxlHnW.js";import{_ as b}from"./Label.vue_vue_type_script_setup_true_lang-D7H4d0ek.js";import{u as ce}from"./useMaterialOrder-B6qVT1Rr.js";import{m as pe}from"./materialOrder-BaOn5p1Y.js";import"./Collection-BA_9eYIH.js";import"./index-CE7v__89.js";import"./utils-DU_xaL7B.js";import"./DialogTitle-0IlAdc_J.js";import"./createLucideIcon-CDvnuoGZ.js";import"./x-CwbFRCqd.js";import"./check-DENv59y8.js";import"./apiClient-r2tmWO-w.js";const ve={key:0,class:"text-sm text-muted-foreground text-center py-8"},_e={key:1,class:"flex items-center justify-center py-16 border border-dashed border-border rounded-lg"},ge={key:2,class:"space-y-4"},xe=["onClick"],ye={class:"text-xs text-muted-foreground"},be={class:"text-sm font-medium"},ke={class:"text-xs text-muted-foreground"},Ee={class:"text-sm font-medium bg-muted/30 border border-foreground px-2 py-0.5 rounded"},$e={key:0,class:"flex items-center gap-2 flex-wrap"},he={class:"font-semibold ml-1"},we={class:"text-muted-foreground ml-0.5"},Ce={key:0,class:"overflow-x-auto"},Ie={class:"space-y-5 py-2"},Ne={class:"space-y-2"},Oe={class:"space-y-2"},De={key:0,class:"space-y-2"},Re={class:"flex flex-wrap gap-3"},Se=["for"],Te={key:1,class:"space-y-2"},Le={class:"flex flex-wrap gap-3"},Me=["for"],Pe={key:2,class:"space-y-2"},Ve={class:"flex flex-wrap gap-3"},Ue=["for"],je={key:3,class:"space-y-2"},qe={class:"flex flex-wrap gap-3"},Ae=["for"],Be={class:"flex gap-2"},ze={key:0,class:"text-sm text-muted-foreground"},dt=W({__name:"InvoicePage",setup(Fe){const{orders:U,isLoading:B,loadOrders:j}=ce(),p=X({}),k=c(!1),m=c(null),R=c([]),S=c([]),E=c([]),$=c([]),h=c([]),w=c([]),C=c(!1),T=N(()=>{if(!m.value)return[];const l=new Map;return m.value.orderLines.forEach(e=>{e.zoneId!=null&&e.zoneName&&l.set(e.zoneId,e.zoneName)}),Array.from(l,([e,t])=>({id:e,name:t}))}),L=N(()=>{if(!m.value)return[];const l=new Map;return m.value.orderLines.forEach(e=>{e.floorId!=null&&e.floorName&&l.set(e.floorId,e.floorName)}),Array.from(l,([e,t])=>({id:e,name:t}))}),M=N(()=>{if(!m.value)return[];const l=new Map;return m.value.orderLines.forEach(e=>{e.sectionId!=null&&e.sectionName&&l.set(e.sectionId,e.sectionName)}),Array.from(l,([e,t])=>({id:e,name:t}))}),P=N(()=>{if(!m.value)return[];const l=new Map;return m.value.orderLines.forEach(e=>{e.usageId!=null&&e.usageName&&l.set(e.usageId,e.usageName)}),Array.from(l,([e,t])=>({id:e,name:t}))});function z(l){if(p[l])p[l]=!1;else{for(const e of Object.keys(p))p[Number(e)]=!1;p[l]=!0}}async function F(l){m.value=l,R.value=[],S.value=[],await se(),E.value=T.value.map(e=>e.id),$.value=L.value.map(e=>e.id),h.value=M.value.map(e=>e.id),w.value=P.value.map(e=>e.id),k.value=!0}function Q(l){const e=l.target;R.value=e.files?Array.from(e.files):[]}function Z(l){const e=l.target;S.value=e.files?Array.from(e.files):[]}function I(l,e){return l.includes(e)?l.filter(t=>t!==e):[...l,e]}async function G(){if(m.value){C.value=!0;try{await pe.createMaterialDelivery({orderId:m.value.id,materialTypeId:m.value.materialTypeId,workTypeId:m.value.workTypeId,deliveryNotes:R.value,deliveryPhotos:S.value,zoneIds:E.value,floorIds:$.value,sectionIds:h.value,usageIds:w.value}),k.value=!1,j()}catch(l){console.error("송장입력 실패:",l);const e=l;alert(e.response?.data?.message||e.message)}finally{C.value=!1}}}Y(()=>{j()});function H(l){switch(l){case"BEFORE_ORDER":return"발주전";case"ORDER_COMPLETED":return"발주완료";case"RECEIPT_COMPLETED":return"반입완료";default:return l}}function J(l){switch(l){case"BEFORE_ORDER":return"bg-red-500 text-white hover:bg-red-500/80";case"ORDER_COMPLETED":return"bg-green-500 text-white hover:bg-green-500/80";case"RECEIPT_COMPLETED":return"bg-blue-500 text-white hover:bg-blue-500/80";default:return"bg-muted text-muted-foreground"}}function K(l){const e=[l.zoneName,l.floorName,l.sectionName,l.usageName].filter(Boolean);return e.length>0?e.join(" "):"-"}return(l,e)=>(r(),V(le,{title:"자재발주서"},{default:o(()=>[a(ae,{height:"flex-1","min-height":"1100px"},{default:o(()=>[s(B)?(r(),i("div",ve," 발주서 목록 로딩 중... ")):s(U).length===0?(r(),i("div",_e,[...e[3]||(e[3]=[u("p",{class:"text-muted-foreground"}," 발주서가 없습니다. 3D 공정표에서 부재를 선택하여 발주서를 생성하세요. ",-1)])])):(r(),i("div",ge,[(r(!0),i(v,null,_(s(U),t=>(r(),i("div",{key:t.id,class:"border border-border rounded-lg overflow-hidden"},[u("div",{class:"flex items-center gap-3 px-4 py-3 bg-muted/30 cursor-pointer select-none",onClick:f=>z(t.id)},[u("span",ye,d(p[t.id]?"▲":"▼"),1),a(s(q),{class:ee(["text-sm px-3 py-1",J(t.orderStatus)])},{default:o(()=>[n(d(H(t.orderStatus)),1)]),_:2},1032,["class"]),u("span",be,d(t.orderNo),1),u("span",ke,d(t.workTypeName),1),u("span",Ee,d(t.totalQuantity)+" "+d(t.unit),1),t.specSummary?.length>0?(r(),i("div",$e,[(r(!0),i(v,null,_(t.specSummary,f=>(r(),V(s(q),{key:f.materialSpecId,variant:"outline",class:"text-sm px-2.5 py-1"},{default:o(()=>[n(d(f.materialSpecName)+" ",1),u("span",he,d(f.quantity),1),u("span",we,d(t.unit),1)]),_:2},1024))),128))])):g("",!0),u("div",{class:"flex items-center gap-2 ml-auto",onClick:e[0]||(e[0]=te(()=>{},["stop"]))},[a(s(O),{variant:"outline",size:"sm",disabled:t.orderStatus==="ORDER_COMPLETED"||t.orderStatus==="RECEIPT_COMPLETED"},{default:o(()=>[...e[4]||(e[4]=[n(" 발주하기 ",-1)])]),_:1},8,["disabled"]),a(s(O),{variant:"outline",size:"sm",disabled:t.orderStatus!=="ORDER_COMPLETED",onClick:f=>F(t)},{default:o(()=>[...e[5]||(e[5]=[n(" 송장입력 ",-1)])]),_:1},8,["disabled","onClick"])])],8,xe),p[t.id]?(r(),i("div",Ce,[a(s(oe),null,{default:o(()=>[a(s(ne),null,{default:o(()=>[a(s(A),null,{default:o(()=>[a(s(x),null,{default:o(()=>[...e[6]||(e[6]=[n("오브젝트",-1)])]),_:1}),a(s(x),null,{default:o(()=>[...e[7]||(e[7]=[n("자재규격",-1)])]),_:1}),a(s(x),null,{default:o(()=>[...e[8]||(e[8]=[n("부재코드",-1)])]),_:1}),a(s(x),null,{default:o(()=>[...e[9]||(e[9]=[n("세부작업",-1)])]),_:1}),a(s(x),null,{default:o(()=>[...e[10]||(e[10]=[n("위치",-1)])]),_:1}),a(s(x),{class:"text-right"},{default:o(()=>[...e[11]||(e[11]=[n("수량",-1)])]),_:1})]),_:1})]),_:1}),a(s(re),null,{default:o(()=>[(r(!0),i(v,null,_(t.orderLines,f=>(r(),V(s(A),{key:f.id},{default:o(()=>[a(s(y),{class:"text-sm"},{default:o(()=>[n(d(f.object3dId??"-"),1)]),_:2},1024),a(s(y),{class:"text-sm"},{default:o(()=>[n(d(f.materialSpecName),1)]),_:2},1024),a(s(y),{class:"text-sm"},{default:o(()=>[n(d(f.componentCodeName??"-"),1)]),_:2},1024),a(s(y),{class:"text-sm"},{default:o(()=>[n(d(f.workStepName??"-"),1)]),_:2},1024),a(s(y),{class:"text-sm"},{default:o(()=>[n(d(K(f)),1)]),_:2},1024),a(s(y),{class:"text-sm text-right"},{default:o(()=>[n(d(f.quantity),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)])):g("",!0)]))),128))]))]),_:1}),a(s(me),{open:k.value,"onUpdate:open":e[2]||(e[2]=t=>k.value=t)},{default:o(()=>[a(s(ue),{class:"sm:max-w-[520px]"},{default:o(()=>[a(s(ie),null,{default:o(()=>[a(s(de),null,{default:o(()=>[...e[12]||(e[12]=[n("송장입력",-1)])]),_:1})]),_:1}),u("div",Ie,[u("div",Ne,[a(s(b),null,{default:o(()=>[...e[13]||(e[13]=[n("송장파일",-1)])]),_:1}),u("input",{type:"file",multiple:"",accept:".pdf,.png,.jpg,.jpeg",class:"block w-full text-sm text-foreground file:mr-3 file:py-1.5 file:px-3 file:rounded file:border file:border-input file:bg-muted file:text-sm file:font-medium hover:file:bg-muted/80 cursor-pointer",onChange:Q},null,32)]),u("div",Oe,[a(s(b),null,{default:o(()=>[...e[14]||(e[14]=[n("반입사진",-1)])]),_:1}),u("input",{type:"file",multiple:"",accept:"image/*",class:"block w-full text-sm text-foreground file:mr-3 file:py-1.5 file:px-3 file:rounded file:border file:border-input file:bg-muted file:text-sm file:font-medium hover:file:bg-muted/80 cursor-pointer",onChange:Z},null,32)]),T.value.length>0?(r(),i("div",De,[a(s(b),null,{default:o(()=>[...e[15]||(e[15]=[n("존",-1)])]),_:1}),u("div",Re,[(r(!0),i(v,null,_(T.value,t=>(r(),i("div",{key:t.id,class:"flex items-center gap-1.5"},[a(s(D),{id:`zone-${t.id}`,"model-value":E.value.includes(t.id),"onUpdate:modelValue":f=>E.value=I(E.value,t.id)},null,8,["id","model-value","onUpdate:modelValue"]),u("label",{for:`zone-${t.id}`,class:"text-sm cursor-pointer"},d(t.name),9,Se)]))),128))])])):g("",!0),L.value.length>0?(r(),i("div",Te,[a(s(b),null,{default:o(()=>[...e[16]||(e[16]=[n("층",-1)])]),_:1}),u("div",Le,[(r(!0),i(v,null,_(L.value,t=>(r(),i("div",{key:t.id,class:"flex items-center gap-1.5"},[a(s(D),{id:`floor-${t.id}`,"model-value":$.value.includes(t.id),"onUpdate:modelValue":f=>$.value=I($.value,t.id)},null,8,["id","model-value","onUpdate:modelValue"]),u("label",{for:`floor-${t.id}`,class:"text-sm cursor-pointer"},d(t.name),9,Me)]))),128))])])):g("",!0),M.value.length>0?(r(),i("div",Pe,[a(s(b),null,{default:o(()=>[...e[17]||(e[17]=[n("구역",-1)])]),_:1}),u("div",Ve,[(r(!0),i(v,null,_(M.value,t=>(r(),i("div",{key:t.id,class:"flex items-center gap-1.5"},[a(s(D),{id:`section-${t.id}`,"model-value":h.value.includes(t.id),"onUpdate:modelValue":f=>h.value=I(h.value,t.id)},null,8,["id","model-value","onUpdate:modelValue"]),u("label",{for:`section-${t.id}`,class:"text-sm cursor-pointer"},d(t.name),9,Ue)]))),128))])])):g("",!0),P.value.length>0?(r(),i("div",je,[a(s(b),null,{default:o(()=>[...e[18]||(e[18]=[n("용도",-1)])]),_:1}),u("div",qe,[(r(!0),i(v,null,_(P.value,t=>(r(),i("div",{key:t.id,class:"flex items-center gap-1.5"},[a(s(D),{id:`usage-${t.id}`,"model-value":w.value.includes(t.id),"onUpdate:modelValue":f=>w.value=I(w.value,t.id)},null,8,["id","model-value","onUpdate:modelValue"]),u("label",{for:`usage-${t.id}`,class:"text-sm cursor-pointer"},d(t.name),9,Ae)]))),128))])])):g("",!0)]),a(s(fe),{class:"flex-col items-end gap-2"},{default:o(()=>[u("div",Be,[a(s(O),{variant:"outline",onClick:e[1]||(e[1]=t=>k.value=!1)},{default:o(()=>[...e[19]||(e[19]=[n("취소",-1)])]),_:1}),a(s(O),{disabled:C.value,onClick:G},{default:o(()=>[n(d(C.value?"저장 중...":"저장"),1)]),_:1},8,["disabled"])]),C.value?(r(),i("p",ze," 시간이 좀 걸립니다. 기다려주세요. ")):g("",!0)]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}});export{dt as default};
