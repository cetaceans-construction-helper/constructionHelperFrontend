import{r as m,d as De,P as $e,y as T,i as Ce,I as Oe,p as Y,w as a,e as s,a as n,c as d,F as v,n as h,u as l,g as r,j as w,t as i,k as le,o as u,q as se,L as Re}from"./index-CLd163ez.js";import{_ as Ue}from"./PageContainer.vue_vue_type_script_setup_true_lang-B_awlWCW.js";import{_ as Le}from"./AreaCard.vue_vue_type_script_setup_true_lang-Buko44Ic.js";import{_ as E}from"./index-D3klz3Fc.js";import{_ as D,a as ae,b as oe,c as S,d as x,e as ne,f as Ne,g as y}from"./Label.vue_vue_type_script_setup_true_lang-CE5dyc1j.js";import{a as re,b as ue,c as de,d as ie,_ as fe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CDKXJmwT.js";import{_ as z}from"./Checkbox.vue_vue_type_script_setup_true_lang-vHn0ggjI.js";import{_ as N}from"./Input.vue_vue_type_script_setup_true_lang-B6U590mK.js";import{m as A}from"./materialOrder-Buy4b60K.js";import"./Collection-DX4XYVmH.js";import"./index-CEphPQ9z.js";import"./utils-m-6WHacx.js";import"./DialogTitle-DgCg-d2N.js";import"./check-BOjRxVQH.js";import"./x-B9Xnmd9v.js";import"./apiClient-B23t6YBI.js";function Ie(){const q=m([]),O=m(!1);async function B(){O.value=!0;try{const $=await A.getMaterialOrderList();q.value=$.sort((b,C)=>new Date(C.createdAt).getTime()-new Date(b.createdAt).getTime())}catch($){console.error("발주서 목록 로드 실패:",$);const b=$;alert(b.response?.data?.message||b.message)}finally{O.value=!1}}return{orders:q,isLoading:O,loadOrders:B}}const Ve={key:0,class:"text-sm text-muted-foreground text-center py-8"},Me={key:1,class:"flex items-center justify-center py-16 border border-dashed border-border rounded-lg"},je={key:2,class:"space-y-4"},Pe={class:"flex items-center gap-3 px-4 py-3 bg-muted/30"},Te={class:"text-sm font-medium"},Se={class:"text-sm font-medium bg-muted/30 border border-foreground px-2 py-0.5 rounded"},ze={class:"flex items-center gap-2 ml-auto"},Ae={key:0,class:"overflow-x-auto"},qe={key:0,class:"text-sm text-muted-foreground text-center py-8"},Be={key:1,class:"flex items-center justify-center py-16 border border-dashed border-border rounded-lg"},Fe={key:2,class:"space-y-4"},Ze={class:"flex items-center gap-3 px-4 py-3 bg-muted/30"},Ke={class:"text-sm font-medium"},Qe={class:"text-sm text-muted-foreground"},Ge={class:"text-sm text-muted-foreground"},He={class:"text-sm font-medium bg-muted/30 border border-foreground px-2 py-0.5 rounded"},Je={class:"ml-auto"},We={class:"space-y-5 py-2"},Xe={class:"space-y-2"},Ye={class:"space-y-2"},et={key:0,class:"space-y-2"},tt={class:"flex flex-wrap gap-3"},lt=["for"],st={key:1,class:"space-y-2"},at={class:"flex flex-wrap gap-3"},ot=["for"],nt={key:2,class:"space-y-2"},rt={class:"flex flex-wrap gap-3"},ut=["for"],dt={key:3,class:"space-y-2"},it={class:"flex flex-wrap gap-3"},ft=["for"],mt={class:"flex gap-2"},ct={key:0,class:"text-sm text-muted-foreground"},vt={key:0,class:"flex gap-6 py-2 flex-1 min-h-0"},pt={class:"w-1/2 flex flex-col gap-2 min-h-0"},gt={key:0,class:"flex-1 flex items-center justify-center border border-border rounded-lg bg-muted/20"},_t={class:"flex-1 min-h-0 border border-border rounded-lg overflow-auto flex items-center justify-center bg-muted/20 p-2"},xt=["src"],yt={key:0,class:"flex items-center justify-center gap-3 shrink-0"},bt={class:"text-sm text-muted-foreground"},kt={key:2,class:"flex-1 flex items-center justify-center border border-border rounded-lg bg-muted/20"},ht={class:"w-1/2 space-y-4 overflow-y-auto"},wt={class:"grid grid-cols-2 gap-4"},Et={class:"space-y-1.5"},Dt={class:"space-y-1.5"},$t={class:"overflow-x-auto border border-border rounded-lg"},Ct={class:"flex items-center gap-1.5"},Ot={key:0,class:"shrink-0 text-yellow-600 dark:text-yellow-400 text-xs font-medium",title:"규격 검증 실패"},Zt=De({__name:"InvoicePage",setup(q){const{orders:O,isLoading:B,loadOrders:$}=Ie(),b=$e({}),C=m(!1),c=m(null),F=m([]),Z=m([]),I=m([]),V=m([]),M=m([]),j=m([]),R=m(!1),K=m([]),Q=m(!1),U=m(!1),k=m(null),p=m([]),g=m(0),G=m(!1),H=T(()=>{if(!c.value)return[];const o=new Map;return c.value.orderLines.forEach(e=>{e.zoneId!=null&&e.zoneName&&o.set(e.zoneId,e.zoneName)}),Array.from(o,([e,t])=>({id:e,name:t}))}),J=T(()=>{if(!c.value)return[];const o=new Map;return c.value.orderLines.forEach(e=>{e.floorId!=null&&e.floorName&&o.set(e.floorId,e.floorName)}),Array.from(o,([e,t])=>({id:e,name:t}))}),W=T(()=>{if(!c.value)return[];const o=new Map;return c.value.orderLines.forEach(e=>{e.sectionId!=null&&e.sectionName&&o.set(e.sectionId,e.sectionName)}),Array.from(o,([e,t])=>({id:e,name:t}))}),X=T(()=>{if(!c.value)return[];const o=new Map;return c.value.orderLines.forEach(e=>{e.usageId!=null&&e.usageName&&o.set(e.usageId,e.usageName)}),Array.from(o,([e,t])=>({id:e,name:t}))});function me(o){b[o]=!b[o]}async function ce(o){c.value=o,F.value=[],Z.value=[],await Re(),I.value=H.value.map(e=>e.id),V.value=J.value.map(e=>e.id),M.value=W.value.map(e=>e.id),j.value=X.value.map(e=>e.id),C.value=!0}function ve(o){const e=o.target;F.value=e.files?Array.from(e.files):[]}function pe(o){const e=o.target;Z.value=e.files?Array.from(e.files):[]}function P(o,e){const t=o.indexOf(e);t===-1?o.push(e):o.splice(t,1)}async function ge(){if(c.value){R.value=!0;try{const o=await A.createMaterialDelivery(c.value.id,F.value,Z.value,I.value,V.value,M.value,j.value);C.value=!1,k.value=o,U.value=!0,ee(o)}catch(o){console.error("송장입력 실패:",o);const e=o;alert(e.response?.data?.message||e.message)}finally{R.value=!1}}}async function ee(o){const e=o.noteResults.map(t=>t.url).filter(Boolean);if(e.length!==0){G.value=!0;try{const t=await Promise.all(e.map(f=>A.getDeliveryNoteImage(f)));p.value=t,g.value=0}catch(t){console.error("송장 이미지 로드 실패:",t)}finally{G.value=!1}}}function _e(){g.value>0&&g.value--}function xe(){g.value<p.value.length-1&&g.value++}async function te(){Q.value=!0;try{K.value=await A.getMaterialDeliveryList()}catch(o){console.error("반입자재 목록 로딩 실패:",o);const e=o;alert(e.response?.data?.message||e.message)}finally{Q.value=!1}}function ye(o){k.value=o,U.value=!0,ee(o)}function be(){U.value=!1,k.value=null,p.value.forEach(o=>URL.revokeObjectURL(o)),p.value=[],g.value=0,$(),te()}Ce(()=>{$(),te()}),Oe(()=>{p.value.forEach(o=>URL.revokeObjectURL(o))});function ke(o){switch(o){case"BEFORE_ORDER":return"발주전";case"ORDER_COMPLETED":return"발주완료";case"RECEIPT_COMPLETED":return"반입완료";default:return o}}function he(o){switch(o){case"BEFORE_ORDER":return"bg-red-500 text-white hover:bg-red-500/80";case"ORDER_COMPLETED":return"bg-green-500 text-white hover:bg-green-500/80";case"RECEIPT_COMPLETED":return"bg-blue-500 text-white hover:bg-blue-500/80";default:return"bg-muted text-muted-foreground"}}function we(o){const e=[o.zoneName,o.floorName,o.sectionName,o.usageName].filter(Boolean);return e.length>0?e.join(" "):"-"}return(o,e)=>(u(),Y(Ue,{title:"자재관리"},{default:a(()=>[s(Le,{height:"flex-1","min-height":"1100px","has-tabs":!0,tabs:[{value:"order",label:"자재 발주서"},{value:"incoming",label:"반입 자재"},{value:"outgoing",label:"반출 자재"},{value:"remaining",label:"잔여 자재"}],"default-tab":"order"},{"tab-order":a(()=>[l(B)?(u(),d("div",Ve," 발주서 목록 로딩 중... ")):l(O).length===0?(u(),d("div",Me,[...e[7]||(e[7]=[n("p",{class:"text-muted-foreground"}," 발주서가 없습니다. 3D 공정표에서 부재를 선택하여 발주서를 생성하세요. ",-1)])])):(u(),d("div",je,[(u(!0),d(v,null,h(l(O),t=>(u(),d("div",{key:t.id,class:"border border-border rounded-lg overflow-hidden"},[n("div",Pe,[s(l(Ne),{class:se(["text-sm px-3 py-1",he(t.orderStatus)])},{default:a(()=>[r(i(ke(t.orderStatus)),1)]),_:2},1032,["class"]),n("span",Te,i(t.orderNo),1),n("span",Se,i(t.totalQuantity)+" "+i(t.unit),1),n("div",ze,[s(l(E),{variant:"outline",size:"sm",disabled:t.orderStatus==="ORDER_COMPLETED"||t.orderStatus==="RECEIPT_COMPLETED"},{default:a(()=>[...e[8]||(e[8]=[r(" 발주하기 ",-1)])]),_:1},8,["disabled"]),s(l(E),{variant:"outline",size:"sm",disabled:t.orderStatus!=="ORDER_COMPLETED",onClick:f=>ce(t)},{default:a(()=>[...e[9]||(e[9]=[r(" 송장입력 ",-1)])]),_:1},8,["disabled","onClick"]),s(l(E),{variant:"ghost",size:"sm",onClick:f=>me(t.id)},{default:a(()=>[r(i(b[t.id]?"접기 ▲":"펼치기 ▼"),1)]),_:2},1032,["onClick"])])]),b[t.id]?(u(),d("div",Ae,[s(l(ae),null,{default:a(()=>[s(l(oe),null,{default:a(()=>[s(l(S),null,{default:a(()=>[s(l(x),null,{default:a(()=>[...e[10]||(e[10]=[r("오브젝트",-1)])]),_:1}),s(l(x),null,{default:a(()=>[...e[11]||(e[11]=[r("자재규격",-1)])]),_:1}),s(l(x),null,{default:a(()=>[...e[12]||(e[12]=[r("부재코드",-1)])]),_:1}),s(l(x),null,{default:a(()=>[...e[13]||(e[13]=[r("세부작업",-1)])]),_:1}),s(l(x),null,{default:a(()=>[...e[14]||(e[14]=[r("위치",-1)])]),_:1}),s(l(x),{class:"text-right"},{default:a(()=>[...e[15]||(e[15]=[r("수량",-1)])]),_:1})]),_:1})]),_:1}),s(l(ne),null,{default:a(()=>[(u(!0),d(v,null,h(t.orderLines,f=>(u(),Y(l(S),{key:f.id},{default:a(()=>[s(l(y),{class:"text-sm"},{default:a(()=>[r(i(f.object3dId??"-"),1)]),_:2},1024),s(l(y),{class:"text-sm"},{default:a(()=>[r(i(f.materialSpecName),1)]),_:2},1024),s(l(y),{class:"text-sm"},{default:a(()=>[r(i(f.componentCodeName??"-"),1)]),_:2},1024),s(l(y),{class:"text-sm"},{default:a(()=>[r(i(f.workStepName??"-"),1)]),_:2},1024),s(l(y),{class:"text-sm"},{default:a(()=>[r(i(we(f)),1)]),_:2},1024),s(l(y),{class:"text-sm text-right"},{default:a(()=>[r(i(f.quantity),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)])):w("",!0)]))),128))]))]),"tab-incoming":a(()=>[Q.value?(u(),d("div",qe," 반입자재 목록 로딩 중... ")):K.value.length===0?(u(),d("div",Be,[...e[16]||(e[16]=[n("p",{class:"text-muted-foreground"},"반입된 자재가 없습니다.",-1)])])):(u(),d("div",Fe,[(u(!0),d(v,null,h(K.value,t=>(u(),d("div",{key:t.materialDeliveryId,class:"border border-border rounded-lg overflow-hidden"},[n("div",Ze,[n("span",Ke,i(t.materialOrderNumber),1),n("span",Qe,i(t.supplier),1),n("span",Ge,i(t.deliveryDate),1),n("span",He,i(t.noteResults.reduce((f,_)=>f+_.items.length,0))+"개 품목 ",1),n("div",Je,[s(l(E),{variant:"outline",size:"sm",onClick:f=>ye(t)},{default:a(()=>[...e[17]||(e[17]=[r(" 수정하기 ",-1)])]),_:1},8,["onClick"])])])]))),128))]))]),"tab-outgoing":a(()=>[...e[18]||(e[18]=[n("div",{class:"flex-1 flex items-center justify-center border border-dashed border-border rounded-lg"},[n("p",{class:"text-muted-foreground"},"반출 자재 (구현 예정)")],-1)])]),"tab-remaining":a(()=>[...e[19]||(e[19]=[n("div",{class:"flex-1 flex items-center justify-center border border-dashed border-border rounded-lg"},[n("p",{class:"text-muted-foreground"},"잔여 자재 (구현 예정)")],-1)])]),_:1}),s(l(fe),{open:C.value,"onUpdate:open":e[1]||(e[1]=t=>C.value=t)},{default:a(()=>[s(l(re),{class:"sm:max-w-[520px]"},{default:a(()=>[s(l(ue),null,{default:a(()=>[s(l(de),null,{default:a(()=>[...e[20]||(e[20]=[r("송장입력",-1)])]),_:1})]),_:1}),n("div",We,[n("div",Xe,[s(l(D),null,{default:a(()=>[...e[21]||(e[21]=[r("송장파일",-1)])]),_:1}),n("input",{type:"file",multiple:"",accept:".pdf,.png,.jpg,.jpeg",class:"block w-full text-sm text-foreground file:mr-3 file:py-1.5 file:px-3 file:rounded file:border file:border-input file:bg-muted file:text-sm file:font-medium hover:file:bg-muted/80 cursor-pointer",onChange:ve},null,32)]),n("div",Ye,[s(l(D),null,{default:a(()=>[...e[22]||(e[22]=[r("반입사진",-1)])]),_:1}),n("input",{type:"file",multiple:"",accept:"image/*",class:"block w-full text-sm text-foreground file:mr-3 file:py-1.5 file:px-3 file:rounded file:border file:border-input file:bg-muted file:text-sm file:font-medium hover:file:bg-muted/80 cursor-pointer",onChange:pe},null,32)]),H.value.length>0?(u(),d("div",et,[s(l(D),null,{default:a(()=>[...e[23]||(e[23]=[r("존",-1)])]),_:1}),n("div",tt,[(u(!0),d(v,null,h(H.value,t=>(u(),d("div",{key:t.id,class:"flex items-center gap-1.5"},[s(l(z),{id:`zone-${t.id}`,checked:I.value.includes(t.id),"onUpdate:checked":f=>P(I.value,t.id)},null,8,["id","checked","onUpdate:checked"]),n("label",{for:`zone-${t.id}`,class:"text-sm cursor-pointer"},i(t.name),9,lt)]))),128))])])):w("",!0),J.value.length>0?(u(),d("div",st,[s(l(D),null,{default:a(()=>[...e[24]||(e[24]=[r("층",-1)])]),_:1}),n("div",at,[(u(!0),d(v,null,h(J.value,t=>(u(),d("div",{key:t.id,class:"flex items-center gap-1.5"},[s(l(z),{id:`floor-${t.id}`,checked:V.value.includes(t.id),"onUpdate:checked":f=>P(V.value,t.id)},null,8,["id","checked","onUpdate:checked"]),n("label",{for:`floor-${t.id}`,class:"text-sm cursor-pointer"},i(t.name),9,ot)]))),128))])])):w("",!0),W.value.length>0?(u(),d("div",nt,[s(l(D),null,{default:a(()=>[...e[25]||(e[25]=[r("구역",-1)])]),_:1}),n("div",rt,[(u(!0),d(v,null,h(W.value,t=>(u(),d("div",{key:t.id,class:"flex items-center gap-1.5"},[s(l(z),{id:`section-${t.id}`,checked:M.value.includes(t.id),"onUpdate:checked":f=>P(M.value,t.id)},null,8,["id","checked","onUpdate:checked"]),n("label",{for:`section-${t.id}`,class:"text-sm cursor-pointer"},i(t.name),9,ut)]))),128))])])):w("",!0),X.value.length>0?(u(),d("div",dt,[s(l(D),null,{default:a(()=>[...e[26]||(e[26]=[r("용도",-1)])]),_:1}),n("div",it,[(u(!0),d(v,null,h(X.value,t=>(u(),d("div",{key:t.id,class:"flex items-center gap-1.5"},[s(l(z),{id:`usage-${t.id}`,checked:j.value.includes(t.id),"onUpdate:checked":f=>P(j.value,t.id)},null,8,["id","checked","onUpdate:checked"]),n("label",{for:`usage-${t.id}`,class:"text-sm cursor-pointer"},i(t.name),9,ft)]))),128))])])):w("",!0)]),s(l(ie),{class:"flex-col items-end gap-2"},{default:a(()=>[n("div",mt,[s(l(E),{variant:"outline",onClick:e[0]||(e[0]=t=>C.value=!1)},{default:a(()=>[...e[27]||(e[27]=[r("취소",-1)])]),_:1}),s(l(E),{disabled:R.value,onClick:ge},{default:a(()=>[r(i(R.value?"저장 중...":"저장"),1)]),_:1},8,["disabled"])]),R.value?(u(),d("p",ct," 시간이 좀 걸립니다. 기다려주세요. ")):w("",!0)]),_:1})]),_:1})]),_:1},8,["open"]),s(l(fe),{open:U.value,"onUpdate:open":e[6]||(e[6]=t=>U.value=t)},{default:a(()=>[s(l(re),{class:"sm:max-w-[1200px] max-h-[90vh] flex flex-col",onPointerDownOutside:e[4]||(e[4]=le(()=>{},["prevent"])),onEscapeKeyDown:e[5]||(e[5]=le(()=>{},["prevent"]))},{default:a(()=>[s(l(ue),null,{default:a(()=>[s(l(de),null,{default:a(()=>[...e[28]||(e[28]=[r("송장 인식 결과",-1)])]),_:1})]),_:1}),k.value?(u(),d("div",vt,[n("div",pt,[G.value?(u(),d("div",gt,[...e[29]||(e[29]=[n("p",{class:"text-sm text-muted-foreground"},"이미지 로딩 중...",-1)])])):p.value.length>0?(u(),d(v,{key:1},[n("div",_t,[n("img",{src:p.value[g.value],alt:"송장 이미지",class:"max-w-full max-h-full object-contain"},null,8,xt)]),p.value.length>1?(u(),d("div",yt,[s(l(E),{variant:"outline",size:"sm",disabled:g.value===0,onClick:_e},{default:a(()=>[...e[30]||(e[30]=[r(" ← 이전 ",-1)])]),_:1},8,["disabled"]),n("span",bt,i(g.value+1)+" / "+i(p.value.length),1),s(l(E),{variant:"outline",size:"sm",disabled:g.value===p.value.length-1,onClick:xe},{default:a(()=>[...e[31]||(e[31]=[r(" 다음 → ",-1)])]),_:1},8,["disabled"])])):w("",!0)],64)):(u(),d("div",kt,[...e[32]||(e[32]=[n("p",{class:"text-sm text-muted-foreground"},"이미지가 없습니다",-1)])]))]),n("div",ht,[n("div",wt,[n("div",Et,[s(l(D),null,{default:a(()=>[...e[33]||(e[33]=[r("공급업체",-1)])]),_:1}),s(l(N),{modelValue:k.value.supplier,"onUpdate:modelValue":e[2]||(e[2]=t=>k.value.supplier=t)},null,8,["modelValue"])]),n("div",Dt,[s(l(D),null,{default:a(()=>[...e[34]||(e[34]=[r("납품일",-1)])]),_:1}),s(l(N),{modelValue:k.value.deliveryDate,"onUpdate:modelValue":e[3]||(e[3]=t=>k.value.deliveryDate=t),type:"date"},null,8,["modelValue"])])]),n("div",$t,[s(l(ae),null,{default:a(()=>[s(l(oe),null,{default:a(()=>[s(l(S),null,{default:a(()=>[s(l(x),{class:"w-[80px]"},{default:a(()=>[...e[35]||(e[35]=[r("송장번호",-1)])]),_:1}),s(l(x),null,{default:a(()=>[...e[36]||(e[36]=[r("제조사",-1)])]),_:1}),s(l(x),null,{default:a(()=>[...e[37]||(e[37]=[r("규격",-1)])]),_:1}),s(l(x),{class:"w-[100px] text-right"},{default:a(()=>[...e[38]||(e[38]=[r("수량",-1)])]),_:1})]),_:1})]),_:1}),s(l(ne),null,{default:a(()=>[(u(!0),d(v,null,h(k.value.noteResults,(t,f)=>(u(),d(v,{key:f},[(u(!0),d(v,null,h(t.items,(_,Ee)=>(u(),Y(l(S),{key:`${f}-${Ee}`,class:se({"bg-yellow-50 dark:bg-yellow-950/30":!_.specValidation})},{default:a(()=>[s(l(y),{class:"text-sm text-center"},{default:a(()=>[r(i(f+1),1)]),_:2},1024),s(l(y),null,{default:a(()=>[s(l(N),{"model-value":_.manufacturer??"",class:"h-8 text-sm","onUpdate:modelValue":L=>_.manufacturer=L||null},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),s(l(y),null,{default:a(()=>[n("div",Ct,[s(l(N),{"model-value":_.spec??"",class:"h-8 text-sm","onUpdate:modelValue":L=>_.spec=L||null},null,8,["model-value","onUpdate:modelValue"]),_.specValidation?w("",!0):(u(),d("span",Ot," ⚠ "))])]),_:2},1024),s(l(y),null,{default:a(()=>[s(l(N),{modelValue:_.quantity,"onUpdate:modelValue":L=>_.quantity=L,class:"h-8 text-sm text-right"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["class"]))),128))],64))),128))]),_:1})]),_:1})])])])):w("",!0),s(l(ie),null,{default:a(()=>[s(l(E),{onClick:be},{default:a(()=>[...e[39]||(e[39]=[r("확인",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}});export{Zt as default};
